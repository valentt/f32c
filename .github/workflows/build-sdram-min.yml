name: Build sdram_min Bitstream

on:
  workflow_dispatch:
    inputs:
      device:
        description: 'ECP5 Device'
        required: true
        default: '12k'
        type: choice
        options:
          - '12k'
          - '25k'
          - '45k'
          - '85k'

env:
  DEVICE: ${{ github.event.inputs.device || '12k' }}
  PROJECT_DIR: rtl/proj/lattice/ulx3s/sdram_min_trellis_v2

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install oss-cad-suite
      run: |
        wget -q https://github.com/YosysHQ/oss-cad-suite-build/releases/download/2024-02-14/oss-cad-suite-linux-x64-20240214.tgz
        tar xzf oss-cad-suite-linux-x64-20240214.tgz
        echo "$PWD/oss-cad-suite/bin" >> $GITHUB_PATH

    - name: Build with Make
      working-directory: ${{ env.PROJECT_DIR }}
      run: |
        make FPGA_SIZE=${{ env.DEVICE }}

    - name: Upload bitstream artifact
      uses: actions/upload-artifact@v4
      with:
        name: sdram_min-${{ env.DEVICE }}
        path: ${{ env.PROJECT_DIR }}/sdram_min.bit
